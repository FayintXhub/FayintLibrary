local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local HttpService = game:GetService("HttpService")
local RbxAnalyticsService = game:GetService("RbxAnalyticsService")

local gameScripts = {
    ["129866685202296"] = {
        name = "Last Letter",
        free = "https://raw.githubusercontent.com/FayintXhub/FayintLibrary/refs/heads/main/Last-Letter",
        premium = "https://raw.githubusercontent.com/FayintXhub/Faint/refs/heads/main/Last-Letter"
    },
    ["121864768012064"] = {
        name = "Fish It",
        free = "https://raw.githubusercontent.com/FayintXhub/FayintLibrary/refs/heads/main/Fish-It",
        premium = "https://pastefy.app/iyKwHMOr/raw"
    },
    ["131623223084840"] = {
        name = "Escape Tsunami For Brainrot",
        free = "https://raw.githubusercontent.com/FayintXhub/FayintLibrary/refs/heads/main/ETFB",
        premium = "https://raw.githubusercontent.com/FayintXhub/Faint/refs/heads/main/ETFB"
    },
    ["79305036070450"] = {
        name = "Spin a Baddie",
        free = "https://raw.githubusercontent.com/FayintXhub/FayintLibrary/refs/heads/main/Spin-a-Baddie",
        premium = "https://raw.githubusercontent.com/FayintXhub/Faint/refs/heads/main/Spin-a-Baddie"
    }
}

local CONFIG = {
    PLATOBOOST = {
        SERVICE_ID = 18388,
        SECRET_KEY = "5d5532c2-fdbf-4064-8fac-cae65a2ae1b6",
        USE_NONCE = true,
        HOST = "https://api.platoboost.app"
    },
    PATHS = {
        KEY_FOLDER = "FayintKeySystem",
        KEY_FILE = "FayintKeySystem/key.txt"
    },
    DISCORD = {
        INVITE_LINK = "https://discord.gg/JnUtNJWmjW"
    }
}

local player = Players.LocalPlayer
local requestSending = false
local cachedLink, cachedTime = "", 0
local currentGameId = tostring(game.PlaceId)

local function getHardwareId()
    return tostring(RbxAnalyticsService:GetClientId())
end

local function generateNonce()
    local str = ""
    for _ = 1, 16 do
        str = str .. string.char(math.random(97, 122))
    end
    return str
end

local function lDigest(input)
    local inputStr = tostring(input)
    local hash = {}
    for i = 1, #inputStr do
        table.insert(hash, string.byte(inputStr, i))
    end
    local hashHex = ""
    for _, byte in ipairs(hash) do
        hashHex = hashHex .. string.format("%02x", byte)
    end
    return hashHex
end

local function getCurrentGameScript()
    local gameData = gameScripts[currentGameId]
    if gameData then
        return gameData
    end
    return nil
end

local KeyStorage = {}

function KeyStorage.save(key)
    pcall(function()
        makefolder(CONFIG.PATHS.KEY_FOLDER)
    end)
    
    local keyData = {
        key = tostring(key),
        hwid = tostring(getHardwareId()),
        placeId = tostring(game.PlaceId),
        activatedAt = tostring(os.time()),
        userId = tostring(player.UserId)
    }
    
    local success = pcall(function()
        writefile(CONFIG.PATHS.KEY_FILE, HttpService:JSONEncode(keyData))
    end)
    
    if success then
        print("‚úÖ Key saved successfully")
    else
        warn("‚ö†Ô∏è Failed to save key")
    end
end

function KeyStorage.load()
    if not isfile or not isfile(CONFIG.PATHS.KEY_FILE) then
        return nil
    end
    
    local success, content = pcall(function()
        return readfile(CONFIG.PATHS.KEY_FILE)
    end)
    
    if not success or not content then
        return nil
    end
    
    local ok, data = pcall(function()
        return HttpService:JSONDecode(content)
    end)
    
    if not ok or not data then
        print("‚ùå Invalid key data format")
        KeyStorage.delete()
        return nil
    end
    
    local currentHwid = tostring(getHardwareId())
    local currentPlaceId = tostring(game.PlaceId)
    local savedHwid = tostring(data.hwid)
    local savedPlaceId = tostring(data.placeId or "")
    
    if savedHwid ~= currentHwid then
        print("‚ùå HWID mismatch - Key was activated on different device")
        KeyStorage.delete()
        return nil
    end
    
    if savedPlaceId ~= "" and savedPlaceId ~= currentPlaceId then
        print("‚ö†Ô∏è Different game detected, key still valid")
    end
    
    print("‚úÖ Loaded saved key")
    return tostring(data.key)
end

function KeyStorage.delete()
    pcall(function()
        if delfile then
            delfile(CONFIG.PATHS.KEY_FILE)
            print("üóëÔ∏è Saved key deleted")
        end
    end)
end

local Platoboost = {}

function Platoboost.cacheLink()
    if cachedTime + (10 * 60) < os.time() then
        local success, response = pcall(function()
            return request({
                Url = CONFIG.PLATOBOOST.HOST .. "/public/start",
                Method = "POST",
                Body = HttpService:JSONEncode({
                    service = CONFIG.PLATOBOOST.SERVICE_ID,
                    identifier = lDigest(getHardwareId())
                }),
                Headers = {
                    ["Content-Type"] = "application/json"
                }
            })
        end)
        
        if success and response then
            if response.StatusCode == 200 then
                local decoded = HttpService:JSONDecode(response.Body)
                if decoded.success then
                    cachedLink = tostring(decoded.data.url)
                    cachedTime = os.time()
                    return true, cachedLink
                else
                    return false, decoded.message or "Unknown error"
                end
            elseif response.StatusCode == 429 then
                return false, "Rate limited, please wait 20 seconds"
            else
                return false, "Failed to cache link (Status: " .. response.StatusCode .. ")"
            end
        else
            return false, "Network error"
        end
    else
        return true, cachedLink
    end
end

function Platoboost.verifyKey(key)
    if requestSending then
        return false, "Please wait, request in progress"
    end
    requestSending = true
    
    local endpoint = CONFIG.PLATOBOOST.HOST .. "/public/whitelist/" .. 
        tostring(CONFIG.PLATOBOOST.SERVICE_ID) .. 
        "?identifier=" .. lDigest(getHardwareId()) .. 
        "&key=" .. tostring(key)
    
    if CONFIG.PLATOBOOST.USE_NONCE then
        endpoint = endpoint .. "&nonce=" .. generateNonce()
    end
    
    local success, response = pcall(function()
        return request({
            Url = endpoint,
            Method = "GET"
        })
    end)
    
    requestSending = false
    
    if success and response then
        if response.StatusCode == 200 then
            local decoded = HttpService:JSONDecode(response.Body)
            if decoded.success then
                if decoded.data.valid then
                    return true, "‚úÖ Key valid! Access granted."
                else
                    local errorMsg = decoded.message or "Key is invalid"
                    if errorMsg:lower():find("expired") then
                        return false, "‚ùå Key has expired"
                    elseif errorMsg:lower():find("used") or errorMsg:lower():find("already") then
                        return false, "‚ùå Key already used by another device"
                    else
                        return false, "‚ùå " .. errorMsg
                    end
                end
            else
                return false, decoded.message or "Unknown error"
            end
        elseif response.StatusCode == 429 then
            return false, "‚è∞ Rate limited, please wait 20 seconds"
        else
            return false, "üåê Server error, please try again later"
        end
    else
        return false, "üì° Network error, check your connection"
    end
end

local function tryAutoLogin(statusLabel)
    if not isfile or not isfile(CONFIG.PATHS.KEY_FILE) then
        statusLabel.Text = "Status: Ready to activate"
        statusLabel.TextColor3 = Color3.fromRGB(200, 150, 150)
        return false, "No saved key found"
    end
    
    local savedKey = KeyStorage.load()
    if savedKey then
        print("üîÑ Attempting auto-login...")
        statusLabel.Text = "Status: Checking saved key..."
        statusLabel.TextColor3 = Color3.fromRGB(255, 200, 100)
        
        task.wait(0.3)
        
        local isValid, message = Platoboost.verifyKey(savedKey)
        
        if isValid then
            print("‚úÖ Auto-login successful!")
            statusLabel.Text = "Status: ‚úÖ Auto-login successful!"
            statusLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
            return true, savedKey
        else
            print("‚ùå Auto-login failed: " .. message)
            statusLabel.Text = "Status: " .. message
            statusLabel.TextColor3 = Color3.fromRGB(255, 100, 100)
            if message:find("expired") or message:find("invalid") or message:find("used") then
                KeyStorage.delete()
            end
            return false, message
        end
    end
    statusLabel.Text = "Status: Ready to activate"
    statusLabel.TextColor3 = Color3.fromRGB(200, 150, 150)
    return false, "No saved key found"
end

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "FayintKeySystem"
ScreenGui.Parent = player:WaitForChild("PlayerGui")
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

local Frame = Instance.new("Frame")
Frame.Parent = ScreenGui
Frame.BackgroundColor3 = Color3.fromRGB(10, 5, 8)
Frame.BorderSizePixel = 0
Frame.AnchorPoint = Vector2.new(0.5, 0.5)
Frame.Position = UDim2.new(0.5, 0, 0.5, 0)
Frame.Size = UDim2.new(0, 450, 0, 310) 

local Corner = Instance.new("UICorner")
Corner.CornerRadius = UDim.new(0, 12)
Corner.Parent = Frame

local Stroke = Instance.new("UIStroke")
Stroke.Color = Color3.fromRGB(150, 40, 40)
Stroke.Thickness = 2
Stroke.Parent = Frame

-- Title
local Title = Instance.new("TextLabel")
Title.Parent = Frame
Title.BackgroundTransparency = 1
Title.Position = UDim2.new(0, 0, 0, 15)
Title.Size = UDim2.new(1, 0, 0, 30)
Title.Font = Enum.Font.GothamBold
Title.Text = "FAYINT KEY SYSTEM"
Title.TextColor3 = Color3.fromRGB(255, 200, 200)
Title.TextSize = 24
Title.TextXAlignment = Enum.TextXAlignment.Center

-- Get Key Button
local GetKeyButton = Instance.new("TextButton")
GetKeyButton.Parent = Frame
GetKeyButton.BackgroundColor3 = Color3.fromRGB(140, 40, 40)
GetKeyButton.BorderSizePixel = 0
GetKeyButton.AnchorPoint = Vector2.new(0.5, 0)
GetKeyButton.Position = UDim2.new(0.5, 0, 0, 60)
GetKeyButton.Size = UDim2.new(0.85, 0, 0, 35)
GetKeyButton.Font = Enum.Font.GothamBold
GetKeyButton.Text = "üîë CLICK TO GET KEY"
GetKeyButton.TextColor3 = Color3.fromRGB(255, 255, 255)
GetKeyButton.TextSize = 14

local GetKeyCorner = Instance.new("UICorner")
GetKeyCorner.CornerRadius = UDim.new(0, 8)
GetKeyCorner.Parent = GetKeyButton

-- Discord Button (NEW)
local DiscordButton = Instance.new("TextButton")
DiscordButton.Parent = Frame
DiscordButton.BackgroundColor3 = Color3.fromRGB(88, 101, 242) 
DiscordButton.BorderSizePixel = 0
DiscordButton.AnchorPoint = Vector2.new(0.5, 0)
DiscordButton.Position = UDim2.new(0.5, 0, 0, 100)
DiscordButton.Size = UDim2.new(0.85, 0, 0, 35)
DiscordButton.Font = Enum.Font.GothamBold
DiscordButton.Text = "üí¨ JOIN DISCORD"
DiscordButton.TextColor3 = Color3.fromRGB(255, 255, 255)
DiscordButton.TextSize = 14

local DiscordCorner = Instance.new("UICorner")
DiscordCorner.CornerRadius = UDim.new(0, 8)
DiscordCorner.Parent = DiscordButton

-- Key Input
local KeyInput = Instance.new("TextBox")
KeyInput.Parent = Frame
KeyInput.BackgroundColor3 = Color3.fromRGB(20, 10, 15)
KeyInput.BorderSizePixel = 0
KeyInput.AnchorPoint = Vector2.new(0.5, 0)
KeyInput.Position = UDim2.new(0.5, 0, 0, 145)
KeyInput.Size = UDim2.new(0.85, 0, 0, 40)
KeyInput.Font = Enum.Font.Gotham
KeyInput.PlaceholderText = "Enter your license key here..."
KeyInput.PlaceholderColor3 = Color3.fromRGB(255, 255, 255)
KeyInput.Text = ""
KeyInput.TextColor3 = Color3.fromRGB(255, 220, 220)
KeyInput.TextSize = 14
KeyInput.ClearTextOnFocus = false

local InputCorner = Instance.new("UICorner")
InputCorner.CornerRadius = UDim.new(0, 8)
InputCorner.Parent = KeyInput

local InputStroke = Instance.new("UIStroke")
InputStroke.Color = Color3.fromRGB(150, 40, 40)
InputStroke.Thickness = 1
InputStroke.Parent = KeyInput

-- Activate Button
local ActivateButton = Instance.new("TextButton")
ActivateButton.Parent = Frame
ActivateButton.BackgroundColor3 = Color3.fromRGB(40, 80, 120)
ActivateButton.BorderSizePixel = 0
ActivateButton.AnchorPoint = Vector2.new(0.5, 0)
ActivateButton.Position = UDim2.new(0.5, 0, 0, 195)
ActivateButton.Size = UDim2.new(0.85, 0, 0, 35)
ActivateButton.Font = Enum.Font.GothamBold
ActivateButton.Text = "üöÄ ACTIVATE KEY"
ActivateButton.TextColor3 = Color3.fromRGB(255, 255, 255)
ActivateButton.TextSize = 14

local ActivateCorner = Instance.new("UICorner")
ActivateCorner.CornerRadius = UDim.new(0, 8)
ActivateCorner.Parent = ActivateButton

-- Status Label
local StatusLabel = Instance.new("TextLabel")
StatusLabel.Parent = Frame
StatusLabel.BackgroundColor3 = Color3.fromRGB(20, 10, 15)
StatusLabel.BorderSizePixel = 0
StatusLabel.AnchorPoint = Vector2.new(0.5, 0)
StatusLabel.Position = UDim2.new(0.5, 0, 0, 250)
StatusLabel.Size = UDim2.new(0.85, 0, 0, 35)
StatusLabel.Font = Enum.Font.Gotham
StatusLabel.Text = "Status: Ready to activate"
StatusLabel.TextColor3 = Color3.fromRGB(200, 150, 150)
StatusLabel.TextSize = 13

local StatusCorner = Instance.new("UICorner")
StatusCorner.CornerRadius = UDim.new(0, 8)
StatusCorner.Parent = StatusLabel

-- Close Button
local CloseButton = Instance.new("TextButton")
CloseButton.Parent = Frame
CloseButton.BackgroundColor3 = Color3.fromRGB(80, 30, 30)
CloseButton.BorderSizePixel = 0
CloseButton.Position = UDim2.new(1, -32, 0, 8)
CloseButton.Size = UDim2.new(0, 24, 0, 24)
CloseButton.Font = Enum.Font.GothamBold
CloseButton.Text = "√ó"
CloseButton.TextColor3 = Color3.fromRGB(255, 200, 200)
CloseButton.TextSize = 18

local CloseCorner = Instance.new("UICorner")
CloseCorner.CornerRadius = UDim.new(0, 6)
CloseCorner.Parent = CloseButton

local function loadMenu(isPremium)
    _G.AccessGranted = true
    ScreenGui:Destroy()
    
    local gameData = getCurrentGameScript()
    
    if gameData then
        local scriptUrl = isPremium and gameData.premium or gameData.free
        print("üéÆ Loading " .. gameData.name .. " (" .. (isPremium and "Premium" or "Free") .. ")...")
        print("üìú Script URL: " .. scriptUrl)
        
        local success, err = pcall(function()
            loadstring(game:HttpGet(scriptUrl))()
        end)
        
        if success then
            print("‚úÖ " .. gameData.name .. " loaded successfully!")
        else
            warn("‚ùå Failed to load script: " .. tostring(err))
        end
    else
        print("‚ö†Ô∏è Game not supported! PlaceId: " .. currentGameId)
        print("‚ÑπÔ∏è Loading default script...")
        loadstring(game:HttpGet("https://raw.githubusercontent.com/FayintXhub/FayintLibrary/refs/heads/main/Last-Letter"))()
    end
end

-- Get Key Button
GetKeyButton.MouseButton1Click:Connect(function()
    StatusLabel.Text = "Status: Getting key link..."
    StatusLabel.TextColor3 = Color3.fromRGB(255, 200, 100)
    
    -- Button loading state
    GetKeyButton.Text = "‚è≥ LOADING..."
    GetKeyButton.BackgroundColor3 = Color3.fromRGB(100, 100, 100)
    
    local success, link = Platoboost.cacheLink()
    
    if success then
        setclipboard(tostring(link))
        StatusLabel.Text = "Status: ‚úÖ Link copied to clipboard!"
        StatusLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
        
        -- Button success animation
        GetKeyButton.Text = "‚úÖ COPIED!"
        GetKeyButton.BackgroundColor3 = Color3.fromRGB(67, 181, 129) -- Green
        
        task.wait(1.5)
        
        -- Reset button
        GetKeyButton.Text = "üîë CLICK TO GET KEY"
        GetKeyButton.BackgroundColor3 = Color3.fromRGB(140, 40, 40)
    else
        StatusLabel.Text = "Status: ‚ùå Failed to get link: " .. tostring(link)
        StatusLabel.TextColor3 = Color3.fromRGB(255, 100, 100)
        
        -- Button error state
        GetKeyButton.Text = "‚ùå FAILED"
        GetKeyButton.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
        
        task.wait(1.5)
        
        -- Reset button
        GetKeyButton.Text = "üîë CLICK TO GET KEY"
        GetKeyButton.BackgroundColor3 = Color3.fromRGB(140, 40, 40)
    end
end)

-- Discord Button (NEW)
DiscordButton.MouseButton1Click:Connect(function()
    local discordLink = CONFIG.DISCORD.INVITE_LINK
    
    -- Copy to clipboard
    local success = pcall(function()
        setclipboard(discordLink)
    end)
    
    if success then
        StatusLabel.Text = "Status: ‚úÖ Discord link copied!"
        StatusLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
        
        -- Button animation
        DiscordButton.Text = "‚úÖ COPIED!"
        DiscordButton.BackgroundColor3 = Color3.fromRGB(67, 181, 129) 
        
        task.wait(1.5)
        
        DiscordButton.Text = "üí¨ JOIN DISCORD"
        DiscordButton.BackgroundColor3 = Color3.fromRGB(88, 101, 242)
    else
        StatusLabel.Text = "Status: ‚ùå Failed to copy Discord link"
        StatusLabel.TextColor3 = Color3.fromRGB(255, 100, 100)
    end
end)

-- Activate Button
ActivateButton.MouseButton1Click:Connect(function()
    local key = KeyInput.Text:gsub("%s+", "")
    if key == "" then
        StatusLabel.Text = "Status: ‚ùå Please enter a license key"
        StatusLabel.TextColor3 = Color3.fromRGB(255, 100, 100)
        return
    end
    
    StatusLabel.Text = "Status: Verifying key..."
    StatusLabel.TextColor3 = Color3.fromRGB(255, 200, 100)
    ActivateButton.Text = "‚è≥ VERIFYING..."
    ActivateButton.BackgroundColor3 = Color3.fromRGB(100, 100, 100)
    
    local isValid, message = Platoboost.verifyKey(key)
    
    if isValid then
        KeyStorage.save(key)
        
        StatusLabel.Text = "Status: " .. message
        StatusLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
        ActivateButton.Text = "‚úÖ SUCCESS!"
        ActivateButton.BackgroundColor3 = Color3.fromRGB(40, 180, 40)
        
        task.wait(0.8)
        
        local isPremium = false
        loadMenu(isPremium)
    else
        StatusLabel.Text = "Status: " .. message
        StatusLabel.TextColor3 = Color3.fromRGB(255, 100, 100)
        ActivateButton.Text = "üöÄ ACTIVATE KEY"
        ActivateButton.BackgroundColor3 = Color3.fromRGB(40, 80, 120)
    end
end)

-- Close Button
CloseButton.MouseButton1Click:Connect(function()
    ScreenGui:Destroy()
end)

task.wait(0.3)
local autoLoginSuccess, autoLoginMessage = tryAutoLogin(StatusLabel)

if autoLoginSuccess then
    print("‚úÖ Auto-login successful! Loading menu...")
    task.wait(0.8)
    
    local isPremium = false
    loadMenu(isPremium)
end
